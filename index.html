<!DOCTYPE html>
<html>
  <head>
    <title>Matrix V27 - Realismo e Interiores</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      let emMovimento = false;
      let alvoX = 0, alvoZ = 0;

      // Componente de Movimento Suave por Olhar
      AFRAME.registerComponent('walk-watch', {
        tick: function () {
          const raycaster = this.el.components.raycaster;
          const intersection = raycaster.getIntersection(document.querySelector('#chao-cidade'));
          const cursor = document.querySelector('#cursor-visual');

          if (intersection && intersection.distance < 15) { // Limite de 15 metros para andar
            cursor.setAttribute('color', 'lime');
            alvoX = intersection.point.x;
            alvoZ = intersection.point.z;
            emMovimento = true;
          } else {
            cursor.setAttribute('color', 'red');
            emMovimento = false;
          }

          if (emMovimento) {
            const rig = document.querySelector('#rig').object3D;
            const dx = alvoX - rig.position.x;
            const dz = alvoZ - rig.position.z;
            const dist = Math.sqrt(dx*dx + dz*dz);

            if (dist > 0.5) { // Se não chegou no ponto, caminha
              rig.position.x += (dx / dist) * 0.08;
              rig.position.z += (dz / dist) * 0.08;
            }
          }
        }
      });

      // Gerador de NPCs (Humanos)
      AFRAME.registerComponent('spawn-npcs', {
        init: function () {
          for(let i=0; i<20; i++) {
            let npc = document.createElement('a-box');
            npc.setAttribute('position', `${(Math.random()-0.5)*100} 0.8 ${(Math.random()-0.5)*100}`);
            npc.setAttribute('width', 0.6); npc.setAttribute('height', 1.7); npc.setAttribute('depth', 0.4);
            npc.setAttribute('color', '#333');
            // Animação simples de caminhada
            npc.setAttribute('animation', `property: position; to: ${npc.getAttribute('position').x} 0.8 100; dur: ${10000 + Math.random()*20000}; loop: true; easing: linear`);
            this.el.appendChild(npc);
          }
        }
      });
    </script>
  </head>
  <body>
    <a-scene background="color: #87CEEB" fog="type: exponential; color: #a3d0e4; density: 0.015">
      
      <a-entity id="rig" position="0 0.1 5">
        <a-camera look-controls raycaster="objects: #chao-cidade; far: 20" walk-watch>
          <a-ring id="cursor-visual" position="0 0 -1" radius-inner="0.02" radius-outer="0.03" color="lime"></a-ring>
        </a-camera>
      </a-entity>

      <a-entity id="mundo" spawn-npcs>
        <a-plane id="chao-cidade" rotation="-90 0 0" width="1000" height="1000" color="#333"></a-plane>
        
        <a-entity position="0 0 -10">
          <a-box position="0 15 0" width="15" height="30" depth="15" material="opacity: 0.3; transparent: true; color: #87CEEB"></a-box>
          
          <a-box position="0 2 0" width="14" height="4" depth="14" color="#eee" material="side: back">
             <a-box position="0 -1.5 -5" width="6" height="1.2" depth="2" color="#444"></a-box>
             <a-text value="RECEPCAO" position="0 0 -4.9" align="center" color="white" width="4"></a-text>
             
             <a-entity position="5 -2 -5">
                <a-box width="2.5" height="3.5" depth="0.1" color="#777"></a-box> <a-text value="ELEVADOR" position="0 4 0" align="center" color="black"></a-text>
             </a-entity>
          </a-box>
        </a-entity>

        <a-box position="25 10 -10" width="20" height="20" depth="20" color="red">
           <a-text value="SHOPPING" position="0 0 10.1" align="center" width="20"></a-text>
        </a-box>

        <a-box position="-25 15 -10" width="15" height="40" depth="15" color="blue">
           <a-text value="BANCO" position="0 0 7.6" align="center" width="20"></a-text>
        </a-box>
      </a-entity>

      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="1 1 1"></a-entity>

    </a-scene>

    <div style="position:fixed; bottom:20px; width:100%; text-align:center; color:white; font-family:sans-serif; pointer-events:none;">
      OLHE PARA O CHÃO PERTO DE VOCÊ PARA CAMINHAR<br>
      (Círculo Verde = Anda | Círculo Vermelho = Longe demais)
    </div>
  </body>
</html>
