<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Fazenda VR - Mobile Proximidade</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>

    <a-scene>
        <a-assets>
            <a-asset-item id="vaca-model" src="vaca.glb"></a-asset-item>
            <a-asset-item id="galinha-model" src="galinha.glb"></a-asset-item>
            <a-asset-item id="porco-model" src="porco.glb"></a-asset-item>
        </a-assets>

        <a-sky color="#87CEEB"></a-sky>

        <a-plane id="chao" position="0 0 0" rotation="-90 0 0" width="100" height="100" color="#7CFC00" class="movimento"></a-plane>

        <a-entity id="vaca" gltf-model="#vaca-model" position="-3 0 -5" class="interativel"
            animation__click="property: position; to: -3 0.5 -5; dur: 200; dir: alternate; loop: 2; startEvents: click">
        </a-entity>

        <a-entity id="galinha" gltf-model="#galinha-model" position="0 0 -4" scale="0.5 0.5 0.5" class="interativel"
            animation__click="property: scale; to: 0.6 0.6 0.6; dur: 200; dir: alternate; loop: 2; startEvents: click">
        </a-entity>

        <a-entity id="porco" gltf-model="#porco-model" position="3 0 -5" scale="0.8 0.8 0.8" class="interativel"
            animation__click="property: rotation; to: 0 360 0; dur: 500; startEvents: click">
        </a-entity>

        <a-entity id="rig" position="0 0 0"> <a-entity camera look-controls position="0 1.6 0">
                <a-entity cursor="fuse: true; fuseTimeout: 1000"
                          position="0 0 -1"
                          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                          material="color: #FF0000; shader: flat"
                          raycaster="objects: .interativel, .movimento; far: 3">
                    <a-animation begin="fusing" easing="ease-in" attribute="scale" from="1 1 1" to="0.1 0.1 0.1" dur="1000"></a-animation>
                    <a-animation begin="mouseleave" easing="ease-in" attribute="scale" from="0.1 0.1 0.1" to="1 1 1" dur="100"></a-animation>
                </a-entity>
            </a-entity>
        </a-entity>

    </a-scene>

    <script>
        const player = document.querySelector('#rig');

        // Lógica de Movimento: Andar até onde você olha no chão
        document.querySelector('#chao').addEventListener('click', function (evt) {
            // Pega a posição onde você clicou no chão
            let novoPonto = evt.detail.intersection.point;
            // Move o jogador (rig) para lá (mantendo a altura Y em 0)
            player.setAttribute('animation', {
                property: 'position',
                to: `${novoPonto.x} 0 ${novoPonto.z}`,
                dur: 2000,
                easing: 'easeInOutQuad'
            });
        });

        // Feedback visual no console
        document.querySelectorAll('.interativel').forEach(animal => {
            animal.addEventListener('click', function () {
                alert("Você alimentou o " + this.id + "!");
            });
        });
    </script>
</body>
</html>
